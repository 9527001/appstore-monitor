<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="App Store åº”ç”¨ä¸Šçº¿ç›‘æ§å·¥å…· - ä½¿ç”¨æ–‡æ¡£">
    <title>ä½¿ç”¨æ–‡æ¡£ - App Store åº”ç”¨ä¸Šçº¿ç›‘æ§</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .help-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .help-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }
        .help-header h1 {
            color: #333;
            font-size: 2em;
            margin-bottom: 10px;
        }
        .help-header .back-link {
            display: inline-block;
            margin-top: 15px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border: 2px solid #667eea;
            border-radius: 6px;
            transition: all 0.3s;
        }
        .help-header .back-link:hover {
            background: #667eea;
            color: white;
        }
        .help-content {
            line-height: 1.8;
            color: #333;
        }
        .help-content h2 {
            color: #667eea;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        .help-content h3 {
            color: #555;
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 12px;
        }
        .help-content ul, .help-content ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        .help-content li {
            margin-bottom: 8px;
        }
        .help-content code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #d63384;
        }
        .help-content pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #667eea;
            margin: 15px 0;
        }
        .help-content pre code {
            background: none;
            padding: 0;
            color: #333;
        }
        .help-content p {
            margin-bottom: 15px;
        }
        .help-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 15px;
            margin-left: 0;
            color: #666;
            font-style: italic;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .last-update-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        .update-label {
            color: #999;
            margin-right: 8px;
        }
        .update-time {
            color: #667eea;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="help-container">
        <div class="help-header">
            <h1>ğŸ“– ä½¿ç”¨æ–‡æ¡£</h1>
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        </div>
        <div id="helpContent" class="help-content">
            <div class="loading">æ­£åœ¨åŠ è½½æ–‡æ¡£...</div>
        </div>
        <div id="lastUpdateInfo" class="last-update-info" style="display: none;">
            <span class="update-label">ğŸ“… æ–‡æ¡£æœ€åæ›´æ–°ï¼š</span>
            <span id="lastUpdateTime" class="update-time">-</span>
        </div>
    </div>

    <script>
        // åŠ è½½å¹¶æ¸²æŸ“ README.md
        async function loadReadme() {
            const helpContent = document.getElementById('helpContent');
            
            // æ£€æµ‹æ˜¯å¦æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè®¿é—®
            const isLocalFile = window.location.protocol === 'file:';
            
            // å°è¯•å¤šç§æ–¹å¼åŠ è½½ README.md
            let markdownText = null;
            let lastError = null;
            
            // è·å–å½“å‰é¡µé¢çš„åŸºç¡€è·¯å¾„ï¼ˆå…¼å®¹ GitLab Pages å’Œ GitHub Pagesï¼‰
            const getBasePath = () => {
                const path = window.location.pathname;
                // å¦‚æœæ˜¯ GitLab Pagesï¼Œè·¯å¾„å¯èƒ½æ˜¯ /project-name/help.html
                // å¦‚æœæ˜¯ GitHub Pagesï¼Œè·¯å¾„å¯èƒ½æ˜¯ /project-name/help.html æˆ– /help.html
                const pathParts = path.split('/').filter(p => p); // ç§»é™¤ç©ºå­—ç¬¦ä¸²
                // ç§»é™¤æ–‡ä»¶åï¼Œä¿ç•™ç›®å½•è·¯å¾„
                if (pathParts.length > 0 && pathParts[pathParts.length - 1].endsWith('.html')) {
                    pathParts.pop(); // ç§»é™¤ help.html
                }
                const basePath = pathParts.length > 0 ? '/' + pathParts.join('/') + '/' : './';
                return basePath;
            };
            
            // å°è¯•å¤šä¸ªå¯èƒ½çš„è·¯å¾„
            const basePath = getBasePath();
            const possiblePaths = [
                basePath + 'README.md',  // ç›¸å¯¹è·¯å¾„ï¼ˆåŸºäºå½“å‰ç›®å½•ï¼‰
                './README.md',           // å½“å‰ç›®å½•
                'README.md',             // ç›´æ¥æ–‡ä»¶å
                '/README.md'             // ç»å¯¹è·¯å¾„ï¼ˆæ ¹ç›®å½•ï¼‰
            ];
            
            console.log('ğŸ“‚ å½“å‰è·¯å¾„:', window.location.pathname);
            console.log('ğŸ“‚ åŸºç¡€è·¯å¾„:', basePath);
            console.log('ğŸ“‚ å°è¯•è·¯å¾„:', possiblePaths);
            
            // å°è¯•å¤šä¸ªè·¯å¾„åŠ è½½ README.md
            let lastModified = null;
            for (const readmePath of possiblePaths) {
                // æ–¹å¼1: å°è¯•ä½¿ç”¨ fetchï¼ˆä¼˜å…ˆï¼Œé€‚ç”¨äº HTTP æœåŠ¡å™¨ï¼‰
                try {
                    const response = await fetch(readmePath);
                    if (response.ok) {
                        markdownText = await response.text();
                        // è·å–æœ€åä¿®æ”¹æ—¶é—´
                        const lastModifiedHeader = response.headers.get('Last-Modified');
                        if (lastModifiedHeader) {
                            lastModified = new Date(lastModifiedHeader);
                        }
                        console.log(`âœ… ä½¿ç”¨ fetch æˆåŠŸåŠ è½½ README.md (è·¯å¾„: ${readmePath})`);
                        if (lastModified) {
                            console.log(`ğŸ“… æœ€åä¿®æ”¹æ—¶é—´: ${lastModified.toLocaleString('zh-CN')}`);
                        }
                        break; // æˆåŠŸåŠ è½½ï¼Œé€€å‡ºå¾ªç¯
                    } else {
                        console.warn(`âš ï¸ è·¯å¾„ ${readmePath} è¿”å›çŠ¶æ€ç : ${response.status}`);
                    }
                } catch (fetchError) {
                    console.warn(`âš ï¸ è·¯å¾„ ${readmePath} fetch åŠ è½½å¤±è´¥:`, fetchError);
                    lastError = fetchError;
                }
            }
            
            // å¦‚æœ fetch éƒ½å¤±è´¥äº†ï¼Œå°è¯•ä½¿ç”¨ XMLHttpRequest
            if (!markdownText) {
                for (const readmePath of possiblePaths) {
                    try {
                        const result = await new Promise((resolve, reject) => {
                            const xhr = new XMLHttpRequest();
                            xhr.open('GET', readmePath, true);
                            xhr.onreadystatechange = function() {
                                if (xhr.readyState === 4) {
                                    if (xhr.status === 200 || (xhr.status === 0 && xhr.responseText)) {
                                        // å°è¯•ä»å“åº”å¤´è·å–æœ€åä¿®æ”¹æ—¶é—´
                                        let modifiedTime = null;
                                        try {
                                            const lastModifiedHeader = xhr.getResponseHeader('Last-Modified');
                                            if (lastModifiedHeader) {
                                                modifiedTime = new Date(lastModifiedHeader);
                                            }
                                        } catch (e) {
                                            console.warn('æ— æ³•è·å–æœ€åä¿®æ”¹æ—¶é—´:', e);
                                        }
                                        resolve({
                                            text: xhr.responseText,
                                            lastModified: modifiedTime
                                        });
                                    } else {
                                        reject(new Error(`XMLHttpRequest failed with status: ${xhr.status}`));
                                    }
                                }
                            };
                            xhr.onerror = function() {
                                reject(new Error('XMLHttpRequest network error'));
                            };
                            xhr.send();
                        });
                        markdownText = result.text;
                        if (result.lastModified && !lastModified) {
                            lastModified = result.lastModified;
                        }
                        console.log(`âœ… ä½¿ç”¨ XMLHttpRequest æˆåŠŸåŠ è½½ README.md (è·¯å¾„: ${readmePath})`);
                        if (lastModified) {
                            console.log(`ğŸ“… æœ€åä¿®æ”¹æ—¶é—´: ${lastModified.toLocaleString('zh-CN')}`);
                        }
                        break; // æˆåŠŸåŠ è½½ï¼Œé€€å‡ºå¾ªç¯
                    } catch (xhrError) {
                        console.warn(`âš ï¸ è·¯å¾„ ${readmePath} XMLHttpRequest åŠ è½½å¤±è´¥:`, xhrError);
                        lastError = xhrError;
                    }
                }
            }
            
            // å¦‚æœæˆåŠŸåŠ è½½ï¼Œæ¸²æŸ“ Markdown
            if (markdownText) {
                try {
                    const html = marked.parse(markdownText);
                    helpContent.innerHTML = html;
                    console.log('âœ… Markdown æ¸²æŸ“æˆåŠŸ');
                    
                    // æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´
                    updateLastModifiedTime(lastModified);
                } catch (parseError) {
                    console.error('âŒ Markdown è§£æå¤±è´¥:', parseError);
                    showError('Markdown è§£æå¤±è´¥: ' + parseError.message);
                }
            } else {
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                showError(lastError);
            }
        }
        
        function showError(error) {
            const helpContent = document.getElementById('helpContent');
            const isLocalFile = window.location.protocol === 'file:';
            
            let errorHtml = '<div style="color: #dc3545; padding: 20px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #dc3545;">';
            errorHtml += '<h3 style="color: #dc3545; margin-top: 0;">âš ï¸ åŠ è½½æ–‡æ¡£å¤±è´¥</h3>';
            
            if (isLocalFile) {
                errorHtml += '<p><strong>æ£€æµ‹åˆ°æ‚¨æ­£åœ¨é€šè¿‡æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè®¿é—®ï¼ˆfile://ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´æ— æ³•åŠ è½½ README.md æ–‡ä»¶ã€‚</strong></p>';
                errorHtml += '<p>è¯·é€šè¿‡ HTTP æœåŠ¡å™¨è¿è¡Œï¼š</p>';
                errorHtml += '<div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 15px 0;">';
                errorHtml += '<p><strong>æ–¹å¼1ï¼šä½¿ç”¨ Python</strong></p>';
                errorHtml += '<pre style="background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>python3 -m http.server 8000</code></pre>';
                errorHtml += '<p><strong>æ–¹å¼2ï¼šä½¿ç”¨ Node.js</strong></p>';
                errorHtml += '<pre style="background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>npx http-server</code></pre>';
                errorHtml += '<p><strong>æ–¹å¼3ï¼šä½¿ç”¨é¡¹ç›®æä¾›çš„è„šæœ¬</strong></p>';
                errorHtml += '<pre style="background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>chmod +x start.sh\n./start.sh</code></pre>';
                errorHtml += '</div>';
                errorHtml += '<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š<code>http://localhost:8000/help.html</code></p>';
            } else {
                errorHtml += '<p>è¯·ç¡®ä¿ <code>README.md</code> æ–‡ä»¶ä¸ <code>help.html</code> åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚</p>';
                errorHtml += '<p>å¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·æ£€æŸ¥ï¼š</p>';
                errorHtml += '<ul>';
                errorHtml += '<li>æ–‡ä»¶æ˜¯å¦å­˜åœ¨</li>';
                errorHtml += '<li>æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®</li>';
                errorHtml += '<li>æœåŠ¡å™¨é…ç½®æ˜¯å¦æ­£ç¡®</li>';
                errorHtml += '</ul>';
            }
            
            if (error && error.message) {
                errorHtml += '<details style="margin-top: 15px;">';
                errorHtml += '<summary style="cursor: pointer; color: #666;">æŸ¥çœ‹é”™è¯¯è¯¦æƒ…</summary>';
                errorHtml += '<pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 10px; overflow-x: auto; font-size: 0.9em;">' + 
                    escapeHtml(error.message) + '</pre>';
                errorHtml += '</details>';
            }
            
            errorHtml += '</div>';
            helpContent.innerHTML = errorHtml;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function updateLastModifiedTime(lastModified) {
            const lastUpdateInfo = document.getElementById('lastUpdateInfo');
            const lastUpdateTime = document.getElementById('lastUpdateTime');
            
            if (lastUpdateInfo && lastUpdateTime) {
                if (lastModified) {
                    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                    const formattedTime = lastModified.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });
                    lastUpdateTime.textContent = formattedTime;
                    lastUpdateInfo.style.display = 'block';
                } else {
                    // å¦‚æœæ²¡æœ‰è·å–åˆ°æ—¶é—´ï¼Œæ˜¾ç¤ºå½“å‰æ—¶é—´ä½œä¸ºå¤‡é€‰
                    const now = new Date();
                    const formattedTime = now.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });
                    lastUpdateTime.textContent = formattedTime + ' (å½“å‰æ—¶é—´)';
                    lastUpdateInfo.style.display = 'block';
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadReadme);
        } else {
            loadReadme();
        }
    </script>
</body>
</html>

